{# ------------------- Query ------------------- 

{% set entriesIds = [] %}
{% for entry in block.sourceStories %}
{% set entriesIds = entriesIds | merge([entry.id]) %}
{% endfor %}

{% set entriesIdsString = entriesIds | join(', not ') %}
{% set source = block.entriesFromCategory ?? (block.entriesFromPrintIssue ?? block.entriesFromTag) %}

{% set sourceEntriesIds = craft.entries
    .relatedTo(source)
    .id('and, not ' ~ entriesIdsString)
    .limit(8 - entriesIds | length )
    .ids
%}

{% set entriesIds = entriesIds | merge(sourceEntriesIds) %}

{% set entriesQuery = craft.entries
    .section('story')
    .id(entriesIds)
    .with([
        'storyHeroImage',
        'storycategory',
        'storyPrintIssue',
        'storyByline',
        'author'
    ])
%}

{% set entries = entriesQuery.all() %}
#}

{% set entries = block.stories %}

{# ------------------- Content ------------------- #}
{% if entries %}
{% embed "_container/_container" %}
{% block content %}
    <div class="mt-16 mb-8">
        <h3 class="inline-block py-2 text-2xl border-b-2 font-display lg:text-3xl border-primary-500">{{ block.heading }}</h3>
    </div>
{% endblock %}
{% endembed %}

<div class="mb-16 js-swiper-carousel swiper-container px-screen-xl">
	<div class="swiper-wrapper">
		{% for entry in entries %}
			{% if entry.storyLandscape %}
			<div class="w-10/12 swiper-slide sm:w-1/2 md:w-2/3 lg:w-1/2">
				{% include "_story/_card" with {
					'entry': entry,
					'layout': 'card sm:card md:widecard lg:widecard',
					'size': 'md',
					'byline': false
				} %}
			</div>
			{% else %}
			<div class="w-10/12 swiper-slide sm:w-1/2 md:w-1/3 lg:w-1/4" >
				{% include "_story/_card" with {
					'entry': entry,
					'layout': 'card sm:card md:card lg:card',
					'size': 'md',
					'byline': false	
				} %}
			</div>

			{% endif %}
		{% endfor %}
	</div>
	{# <div class="swiper-button-prev"></div>
	<div class="swiper-button-next"></div> #}
	<div class="max-w-screen-lg mt-8">
		<div class="h-1 swiper-scrollbar"></div>
	</div>
</div>
{% endif %}

{# ------------------- Record ID ------------------- #}
{# {% set excludeIds = excludeIds|merge([entriesIds])%}
{{ dump(excludeIds)}} #}